# 功能規格：商品拍賣服務

**功能分支**: `002-auction-service`  
**建立日期**: 2025-11-04  
**狀態**: 草稿  
**輸入**: 使用者描述："實作商品拍賣服務，負責商品的建立、查詢、管理與使用者追蹤功能"

**注意**: 根據專案準則，本文件必須使用繁體中文撰寫。

## 使用者情境與測試 *(必填)*

### 使用者故事 1 - 瀏覽與搜尋拍賣商品 (優先順序: P1)

使用者可瀏覽所有進行中的拍賣商品，透過分類篩選、關鍵字搜尋快速找到感興趣的商品，並查看商品詳細資訊包含賣家資訊與目前出價。

**優先順序理由**: 這是拍賣平台的核心功能，使用者必須能夠瀏覽與搜尋商品才能參與競標。沒有此功能，整個拍賣平台無法運作。這是最小可行產品（MVP）的基礎。

**獨立測試**: 可透過查詢商品清單、使用篩選與搜尋功能、查看商品詳細資訊來完整測試此功能，驗證使用者能成功找到並了解商品資訊。

**驗收情境**:

1. **Given** 系統有多個進行中的拍賣商品, **When** 使用者查詢商品清單, **Then** 系統顯示所有進行中的商品（不包含未開始或已結束的商品）
2. **Given** 商品清單超過 20 筆, **When** 使用者查詢第一頁, **Then** 系統顯示前 20 筆商品並提供分頁資訊
3. **Given** 使用者選擇特定分類, **When** 使用者查詢商品清單, **Then** 系統僅顯示該分類的商品
4. **Given** 使用者輸入關鍵字, **When** 使用者搜尋商品, **Then** 系統顯示名稱或描述包含該關鍵字的商品
5. **Given** 使用者選擇按結束時間排序, **When** 使用者查詢商品清單, **Then** 系統按結束時間由近到遠排列商品
6. **Given** 商品存在, **When** 使用者查詢商品詳細資訊, **Then** 系統顯示完整商品資訊（名稱、描述、起標價、開始時間、結束時間、狀態）、賣家資訊（使用者名稱）、目前最高出價
7. **Given** 商品不存在, **When** 使用者查詢該商品, **Then** 系統回傳「商品不存在」訊息

---

### 使用者故事 2 - 建立與管理拍賣商品 (優先順序: P1)

賣家可建立新的拍賣商品，設定商品資訊與結束時間，並在符合條件時編輯或刪除自己的商品。

**優先順序理由**: 商品建立是拍賣平台的另一核心功能，沒有賣家建立商品就沒有可競標的內容。這與商品瀏覽同等重要，是 MVP 的必要組成。

**獨立測試**: 可透過建立新商品、編輯商品、刪除商品來完整測試此功能，驗證賣家能成功管理自己的拍賣商品。

**驗收情境**:

1. **Given** 使用者已登入, **When** 使用者提供商品名稱、描述、起標價與結束時間（至少 1 小時後）建立商品, **Then** 系統成功建立商品並回傳商品資訊
2. **Given** 使用者已登入, **When** 使用者提供的結束時間少於 1 小時後, **Then** 系統拒絕建立並顯示「結束時間必須至少在 1 小時之後」訊息
3. **Given** 使用者已登入, **When** 使用者提供的結束時間在過去, **Then** 系統拒絕建立並顯示「結束時間必須在未來」訊息
4. **Given** 使用者建立的商品尚未有人出價, **When** 使用者編輯商品資訊, **Then** 系統成功更新商品
5. **Given** 使用者建立的商品已有人出價, **When** 使用者嘗試編輯商品, **Then** 系統拒絕編輯並顯示「已有出價的商品無法編輯」訊息
6. **Given** 使用者建立的商品尚未有人出價, **When** 使用者刪除商品, **Then** 系統成功刪除商品
7. **Given** 使用者建立的商品已有人出價, **When** 使用者嘗試刪除商品, **Then** 系統拒絕刪除並顯示「已有出價的商品無法刪除」訊息
8. **Given** 使用者嘗試編輯或刪除其他使用者的商品, **When** 使用者送出請求, **Then** 系統拒絕並回傳「無權限操作此商品」訊息
9. **Given** 使用者已登入, **When** 查詢特定使用者的所有商品, **Then** 系統顯示該使用者建立的所有商品

---

### 使用者故事 3 - 追蹤感興趣的商品 (優先順序: P2)

使用者可將感興趣的商品加入追蹤清單，方便隨時查看這些商品的最新狀態，也可取消不再關注的商品。

**優先順序理由**: 追蹤功能提升使用者體驗，讓使用者能輕鬆管理關注的商品，但不是系統運作的必要條件。使用者仍可透過搜尋找到商品。

**獨立測試**: 可透過追蹤商品、取消追蹤、查看追蹤清單來完整測試此功能，驗證使用者能成功管理追蹤清單。

**驗收情境**:

1. **Given** 使用者已登入且商品存在, **When** 使用者追蹤該商品, **Then** 系統成功將商品加入使用者的追蹤清單
2. **Given** 使用者已追蹤某商品, **When** 使用者再次追蹤同一商品, **Then** 系統回傳「已在追蹤清單中」訊息（不重複追蹤）
3. **Given** 使用者嘗試追蹤自己建立的商品, **When** 使用者送出追蹤請求, **Then** 系統拒絕並顯示「無法追蹤自己的商品」訊息
4. **Given** 使用者已追蹤某商品, **When** 使用者取消追蹤, **Then** 系統成功從追蹤清單中移除該商品
5. **Given** 使用者已登入, **When** 使用者查詢自己的追蹤清單, **Then** 系統顯示所有追蹤的商品及其最新狀態（目前出價、結束時間、狀態）
6. **Given** 使用者未登入, **When** 使用者嘗試追蹤商品, **Then** 系統回傳「需要登入」訊息

---

### 使用者故事 4 - 商品狀態自動管理 (優先順序: P3)

系統根據時間自動更新商品狀態，將已結束的商品標記為「已結束」，確保商品清單顯示正確的狀態。

**優先順序理由**: 狀態自動更新提升系統準確性，但可以在初期透過手動觸發或定期批次處理實現。不影響核心競標流程。

**獨立測試**: 可透過建立即將結束的商品，等待時間過期後驗證狀態是否自動更新為「已結束」。

**驗收情境**:

1. **Given** 商品的結束時間已到, **When** 系統檢查商品狀態, **Then** 商品狀態自動更新為「已結束」
2. **Given** 商品狀態為「已結束」, **When** 使用者查詢商品清單（僅顯示進行中）, **Then** 該商品不出現在清單中
3. **Given** 商品狀態為「已結束」, **When** 使用者嘗試對該商品進行出價、編輯或其他操作, **Then** 系統拒絕並顯示「拍賣已結束」訊息

---

### 邊界情況

- 當商品結束時間即將到達（例如剩餘 1 分鐘），系統如何確保狀態更新的及時性？
- 當大量商品同時結束時，系統如何處理狀態更新的效能問題？
- 當使用者搜尋關鍵字包含特殊字元（如 SQL 注入嘗試）時，系統如何保護？
- 當商品名稱或描述超過合理長度時，系統如何驗證與處理？
- 當 Member Service 或 Bidding Service 無法回應時，商品詳細資訊如何處理？
- 當使用者追蹤大量商品（例如超過 1000 筆）時，追蹤清單的查詢效能如何？
- 當商品的起標價為 0 或負數時，系統如何驗證？

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系統必須顯示所有進行中的拍賣商品清單
- **FR-002**: 系統必須支援按分類篩選商品
- **FR-003**: 系統必須支援關鍵字搜尋商品名稱與描述
- **FR-004**: 系統必須支援分頁顯示，每頁 20 筆商品
- **FR-005**: 系統必須支援按結束時間或目前出價排序商品
- **FR-006**: 系統必須提供查詢單一商品詳細資訊的功能
- **FR-007**: 系統必須在商品詳細資訊中包含賣家資訊（透過呼叫 Member Service 取得）
- **FR-008**: 系統必須在商品詳細資訊中包含目前最高出價（透過呼叫 Bidding Service 取得）
- **FR-009**: 系統必須允許已登入使用者建立新的拍賣商品
- **FR-010**: 系統必須驗證商品建立時提供必要資訊：名稱、描述、起標價、結束時間
- **FR-011**: 系統必須驗證結束時間在當前時間至少 1 小時之後
- **FR-012**: 系統必須自動記錄商品建立者的使用者 ID
- **FR-013**: 系統必須允許使用者編輯自己建立的商品（僅限尚未有出價）
- **FR-014**: 系統必須允許使用者刪除自己建立的商品（僅限尚未有出價）
- **FR-015**: 系統必須拒絕編輯或刪除已有出價的商品
- **FR-016**: 系統必須允許查詢特定使用者的所有商品
- **FR-017**: 系統必須允許已登入使用者追蹤商品
- **FR-018**: 系統必須拒絕使用者追蹤自己建立的商品
- **FR-019**: 系統必須允許使用者取消追蹤商品
- **FR-020**: 系統必須允許使用者查詢自己的追蹤清單
- **FR-021**: 系統必須在追蹤清單中顯示商品的最新狀態
- **FR-022**: 系統必須根據時間自動更新商品狀態（未開始 → 進行中 → 已結束）
- **FR-023**: 系統必須記錄每個商品的建立時間與更新時間
- **FR-024**: 系統必須驗證起標價為正數
- **FR-025**: 系統必須確保使用者只能編輯或刪除自己建立的商品

### 關鍵實體 *(包含資料相關功能)*

- **拍賣商品 (Auction)**: 代表拍賣平台上的商品，包含唯一識別碼、商品名稱、描述、起標價、開始時間、結束時間、狀態（未開始/進行中/已結束）、建立者使用者 ID、建立時間、更新時間
- **商品追蹤 (Follow)**: 代表使用者對商品的追蹤關係，包含使用者 ID、商品 ID、建立時間

## 成功指標 *(必填)*

### 可衡量成果

- **SC-001**: 商品清單查詢回應時間低於 200 毫秒（包含篩選與搜尋）
- **SC-002**: 系統能同時展示 1000 個以上的拍賣商品而不降級
- **SC-003**: 商品狀態自動更新準確率達 100%（無遺漏或錯誤更新）
- **SC-004**: 使用者能在 30 秒內完成商品建立流程（從開始填寫到建立成功）
- **SC-005**: 商品詳細資訊查詢回應時間低於 300 毫秒（包含賣家資訊與最高出價）
- **SC-006**: 搜尋功能準確率達 95%（使用者能找到預期的商品）
- **SC-007**: 追蹤清單查詢回應時間低於 200 毫秒
- **SC-008**: 系統能處理每秒 100 次以上的商品查詢請求
- **SC-009**: 商品建立成功率達 99%（排除使用者輸入錯誤）
- **SC-010**: 跨服務呼叫（Member Service、Bidding Service）成功率達 99%

## 假設

- 假設商品分類為固定選項（例如：電子產品、家具、收藏品等），不需動態管理分類
- 假設商品名稱長度限制為 3-200 字元
- 假設商品描述長度限制為 10-2000 字元
- 假設起標價最大值為 10,000,000（一千萬）
- 假設每個使用者最多可追蹤 500 個商品
- 假設商品狀態更新透過定期背景任務執行（例如每分鐘檢查一次）
- 假設 Member Service 與 Bidding Service 均可用且回應時間在可接受範圍內
- 假設不需要商品圖片上傳功能
- 假設不需要商品推薦或個人化功能
- 假設商品建立後的開始時間為立即（CreatedAt 時間）

## 範圍外

以下功能明確不在本次實作範圍內：

- 商品圖片上傳與管理
- 商品分類的動態管理（新增、編輯、刪除分類）
- 商品推薦功能
- 個人化商品推薦
- 商品收藏功能（與追蹤不同）
- 商品評論與評分
- 商品舉報功能
- 即時通知（商品即將結束提醒等）
- 商品統計資訊（瀏覽次數、追蹤人數等）
- 商品匯出功能
- 批次商品上傳
- 商品草稿功能（儲存但不發布）
